<template>
  <div v-if="data.content && data.contentType==='showAll'" v-html="data.content" :class="data.classes">
  </div>
  <div v-else-if="data.content && data.contentType==='multi'" :class="data.classes">
    <span v-for="item in itemsToDisplay" :class=data.itemClasses>{{item}}</span>
    <button v-if="includeShowMore" class="button is-text showQuantityButton" v-on:click="toggleShowQuantity(showMore)">
      <span v-if="showMore">Show Less</span>
      <span v-else>Show All</span>
    </button>
  </div>
  <div v-else-if="data.content && data.contentType==='text'" :class="data.classes">
    <p v-for="para in paragraphs">{{para}}</p>
    <button v-if="includeShowMore" class="button is-text showQuantityButton" v-on:click="toggleShowQuantity(showMore)">
      <span v-if="showMore">Show Less</span>
      <span v-else>Show All</span>
    </button>
  </div>
  <div v-else-if="data.content && data.contentType==='list'" :class="data.classes">
    <ul>
      <li v-for="item in itemsToDisplay" :class="item.classes" v-html="item.content"></li>
    </ul>
    <button v-if="includeShowMore" class="button is-text showQuantityButton" v-on:click="toggleShowQuantity(showMore)">
      <span v-if="showMore">Show Less</span>
      <span v-else>Show All</span>
    </button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      includeShowMore: true,
      showMore: true,
      paragraphs: [],
      itemsToDisplay: [],
    }
  },
  props: {
    data: {
      type: Object,
    }
  },
  created:function() {
    this.initializeData();
  },
  watch: {
    showMore: function() {
      switch (this.data.contentType) {
        case "text":
          this.paragraphs = this.getParagraphs();
	  break;
	case "multi":
	  this.itemsToDisplay = this.getItemsToDisplay();
	  break;
      }
    },
  },
  methods: {
    initializeData() {
      var data = this.data;
      this.includeShowMore = true;
      this.showMore = (this.data.defaultVisible==='all') ? true: false;
      switch (this.data.contentType) {
	case "multi":
	case "list":
	  this.itemsToDisplay = this.getItemsToDisplay();
	  if ((data.defaultDisplayMax===-1) || (data.content.length<=data.defaultDisplayMax)) {
	    this.includeShowMore = false;  // hide button if set to display all (-1) or fewer items than display limit
	  }
	  break;
        case "text":
          this.paragraphs = this.getParagraphs();
	  var charCounter = 0;
	  this.paragraphs.forEach((thisPara) => {  //hide button if total length is shorter than display limit
	    charCounter += thisPara.length;
	  });
	  if (charCounter <= data.defaultDisplayMax) {
	    this.includeShowMore = false;	  
	  }
	  break;
      }
    },
    getItemsToDisplay() {
      var data = this.data;
      var items;
      if ((data.defaultDisplayMax===-1) ||
          (this.showMore) ||
	  (data.content.length<=data.defaultDisplayMax)) {
            items = data.content;
      }
      else {
        items = data.content.slice(0,data.defaultDisplayMax);
      }
      return items;
    },
    getParagraphs() {
      var data = this.data;
      var paraCounter = 0;
      var paragraphs = [];
      var charCounter = 0;
      if (this.showMore) {  // don't truncate
        paragraphs = data.content;
      }
      else {
        while ((paraCounter<data.content.length) && (charCounter<data.defaultDisplayMax)) {
          var thisPara = data.content[paraCounter];
          if (thisPara.length + charCounter <= data.defaultDisplayMax) {
            paragraphs.push(thisPara);
            charCounter += thisPara.length;
          }
          else {
            var truncatedLength = data.defaultDisplayMax - charCounter;
            paragraphs.push(thisPara.slice(0,truncatedLength) + '...');
            charCounter = data.defaultDisplayMax;
          }
          paraCounter++;
        }
      }
      return paragraphs;
    },
    toggleShowQuantity() {
      this.showMore = !this.showMore;
    }
  }
};
</script>

<style scoped lang="scss">
  p:last-of-type {
    display: inline;
  }

  .showQuantityButton {
    height: auto !important;
    border: none;
    padding: 0px 16px 0px;
  }
</style>