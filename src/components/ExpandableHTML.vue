<template>
  <div v-if="data.content && data.contentType==='showAll'" v-html="data.content" :class="data.classes">
  </div>
  <div v-else-if="data.content && data.contentType==='multi'" :class="data.classes">
    <span v-for="item in itemsToDisplay" :class=data.itemClasses>{{item}}</span>
  </div>
  <div v-else-if="data.content && data.contentType==='text'" :class="data.classes">
    <p v-for="para in paragraphs">{{para}}</p>
    <button class="showQuantityButton" v-on:click="toggleShowQuantity(showMore)">
      <span v-if="showMore">Show Less</span>
      <span v-else>Show All</span>
    </button>
  </div>

</template>

<script>
export default {
  data() {
    return {
      showMore: true,
      paragraphs: [],
    }
  },
  props: {
    data: {
      type: Object,
    }
  },
  created:function() {
    this.showMore = (this.data.defaultVisible==='all') ? true: false;
    this.paragraphs = this.getParagraphs();
  },
  computed: {
     itemsToDisplay() {
      var data = this.data;
      var items;
      if (data.contentType == 'multi' && data.defaultDisplayMax) {
        if ((data.defaultDisplayMax===-1) || (data.content.length<=data.defaultDisplayMax)) {
          items = data.content;
        }
        else { 
          items = data.content.slice(0,data.defaultDisplayMax);
        }
      }
      return items;
    }
  },
  watch: {
    showMore: function() {
      this.paragraphs = this.getParagraphs();
    },
  },
  methods: {
    getParagraphs() {
      var data = this.data;
      var paraCounter = 0;
      var paragraphs = [];
      var charCounter = 0;
      if (this.showMore) {  // don't truncate
        paragraphs = data.content;
      }
      else {
        while ((paraCounter<data.content.length) && (charCounter<data.defaultDisplayMax)) {
          var thisPara = data.content[paraCounter];
          if (thisPara.length + charCounter <= data.defaultDisplayMax) {
            paragraphs.push(thisPara);
            charCounter += thisPara.length;
          }
          else {
            var truncatedLength = data.defaultDisplayMax - charCounter;
            paragraphs.push(thisPara.slice(0,truncatedLength) + '...');
            charCounter = data.defaultDisplayMax;
          }
          paraCounter++;
        }
      }
      return paragraphs;
    },
    toggleShowQuantity() {
      this.showMore = !this.showMore;
    }
  }
};
</script>